<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.system.mapper.mybatis.SystemUsersDetailMapper">
  <resultMap id="BaseResultMap" type="com.system.domain.model.output.SystemUsersDetailOutput">
    <id column="system_users_detail_id" jdbcType="CHAR" property="systemUsersDetailId" />
    <result column="user_id" jdbcType="CHAR" property="userId" />
    <result column="landline" jdbcType="VARCHAR" property="landline" />
    <result column="certificate_type" jdbcType="INTEGER" property="certificateType" />
    <result column="certificate" jdbcType="INTEGER" property="certificate" />
    <result column="amount" jdbcType="DECIMAL" property="amount" />
    <result column="created_user_id" jdbcType="CHAR" property="createdUserId" />
    <result column="created_user_name" jdbcType="VARCHAR" property="createdUserName" />
    <result column="created_date_time" jdbcType="TIMESTAMP" property="createdDateTime" />
    <result column="last_updated_user_id" jdbcType="CHAR" property="lastUpdatedUserId" />
    <result column="last_updated_user_name" jdbcType="VARCHAR" property="lastUpdatedUserName" />
    <result column="last_updated_date_time" jdbcType="TIMESTAMP" property="lastUpdatedDateTime" />
    <result column="is_deleted" jdbcType="INTEGER" property="isDeleted" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="line_limit" jdbcType="DECIMAL" property="lineLimit" />
    <result column="state" jdbcType="INTEGER" property="state" />


  </resultMap>
  <sql id="Base_Column_List">
    system_users_detail_id, user_id, landline, certificate_type, certificate, amount, 
    created_user_id, created_user_name, created_date_time, last_updated_user_id, last_updated_user_name, 
    last_updated_date_time, is_deleted
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from system_users_detail
    where system_users_detail_id = #{systemUsersDetailId,jdbcType=CHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    delete from system_users_detail
    where system_users_detail_id = #{systemUsersDetailId,jdbcType=CHAR}
  </delete>
  <insert id="insert" parameterType="com.system.domain.entity.SystemUsersDetail">
    insert into system_users_detail (system_users_detail_id, user_id, landline, 
      certificate_type, certificate, amount, 
      created_user_id, created_user_name, created_date_time, 
      last_updated_user_id, last_updated_user_name, last_updated_date_time, 
      is_deleted)
    values (#{systemUsersDetailId,jdbcType=CHAR}, #{userId,jdbcType=CHAR}, #{landline,jdbcType=VARCHAR}, 
      #{certificateType,jdbcType=INTEGER}, #{certificate,jdbcType=INTEGER}, #{amount,jdbcType=DECIMAL}, 
      #{createdUserId,jdbcType=CHAR}, #{createdUserName,jdbcType=VARCHAR}, #{createdDateTime,jdbcType=TIMESTAMP}, 
      #{lastUpdatedUserId,jdbcType=CHAR}, #{lastUpdatedUserName,jdbcType=VARCHAR}, #{lastUpdatedDateTime,jdbcType=TIMESTAMP}, 
      #{isDeleted,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.system.domain.entity.SystemUsersDetail">
    insert into system_users_detail
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="systemUsersDetailId != null">
        system_users_detail_id,
      </if>
      <if test="userId != null">
        user_id,
      </if>
      <if test="landline != null">
        landline,
      </if>
      <if test="certificateType != null">
        certificate_type,
      </if>
      <if test="certificate != null">
        certificate,
      </if>
      <if test="amount != null">
        amount,
      </if>
      <if test="createdUserId != null">
        created_user_id,
      </if>
      <if test="createdUserName != null">
        created_user_name,
      </if>
      <if test="createdDateTime != null">
        created_date_time,
      </if>
      <if test="lastUpdatedUserId != null">
        last_updated_user_id,
      </if>
      <if test="lastUpdatedUserName != null">
        last_updated_user_name,
      </if>
      <if test="lastUpdatedDateTime != null">
        last_updated_date_time,
      </if>
      <if test="isDeleted != null">
        is_deleted,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="systemUsersDetailId != null">
        #{systemUsersDetailId,jdbcType=CHAR},
      </if>
      <if test="userId != null">
        #{userId,jdbcType=CHAR},
      </if>
      <if test="landline != null">
        #{landline,jdbcType=VARCHAR},
      </if>
      <if test="certificateType != null">
        #{certificateType,jdbcType=INTEGER},
      </if>
      <if test="certificate != null">
        #{certificate,jdbcType=INTEGER},
      </if>
      <if test="amount != null">
        #{amount,jdbcType=DECIMAL},
      </if>
      <if test="createdUserId != null">
        #{createdUserId,jdbcType=CHAR},
      </if>
      <if test="createdUserName != null">
        #{createdUserName,jdbcType=VARCHAR},
      </if>
      <if test="createdDateTime != null">
        #{createdDateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lastUpdatedUserId != null">
        #{lastUpdatedUserId,jdbcType=CHAR},
      </if>
      <if test="lastUpdatedUserName != null">
        #{lastUpdatedUserName,jdbcType=VARCHAR},
      </if>
      <if test="lastUpdatedDateTime != null">
        #{lastUpdatedDateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null">
        #{isDeleted,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.system.domain.entity.SystemUsersDetail">
    update system_users_detail
    <set>
      <if test="userId != null">
        user_id = #{userId,jdbcType=CHAR},
      </if>
      <if test="landline != null">
        landline = #{landline,jdbcType=VARCHAR},
      </if>
      <if test="certificateType != null">
        certificate_type = #{certificateType,jdbcType=INTEGER},
      </if>
      <if test="certificate != null">
        certificate = #{certificate,jdbcType=INTEGER},
      </if>
      <if test="amount != null">
        amount = #{amount,jdbcType=DECIMAL},
      </if>
      <if test="createdUserId != null">
        created_user_id = #{createdUserId,jdbcType=CHAR},
      </if>
      <if test="createdUserName != null">
        created_user_name = #{createdUserName,jdbcType=VARCHAR},
      </if>
      <if test="createdDateTime != null">
        created_date_time = #{createdDateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="lastUpdatedUserId != null">
        last_updated_user_id = #{lastUpdatedUserId,jdbcType=CHAR},
      </if>
      <if test="lastUpdatedUserName != null">
        last_updated_user_name = #{lastUpdatedUserName,jdbcType=VARCHAR},
      </if>
      <if test="lastUpdatedDateTime != null">
        last_updated_date_time = #{lastUpdatedDateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null">
        is_deleted = #{isDeleted,jdbcType=INTEGER},
      </if>
    </set>
    where system_users_detail_id = #{systemUsersDetailId,jdbcType=CHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.system.domain.entity.SystemUsersDetail">
    update system_users_detail
    set user_id = #{userId,jdbcType=CHAR},
      landline = #{landline,jdbcType=VARCHAR},
      certificate_type = #{certificateType,jdbcType=INTEGER},
      certificate = #{certificate,jdbcType=INTEGER},
      amount = #{amount,jdbcType=DECIMAL},
      created_user_id = #{createdUserId,jdbcType=CHAR},
      created_user_name = #{createdUserName,jdbcType=VARCHAR},
      created_date_time = #{createdDateTime,jdbcType=TIMESTAMP},
      last_updated_user_id = #{lastUpdatedUserId,jdbcType=CHAR},
      last_updated_user_name = #{lastUpdatedUserName,jdbcType=VARCHAR},
      last_updated_date_time = #{lastUpdatedDateTime,jdbcType=TIMESTAMP},
      is_deleted = #{isDeleted,jdbcType=INTEGER}
    where system_users_detail_id = #{systemUsersDetailId,jdbcType=CHAR}
  </update>




  <!-- 表名 -->
  <sql id="tableName">
    system_users_detail
  </sql>
  <!-- 表名对外引用 -->
  <sql id="tableNameOut">
    <bind name="tableName" value="'system_users_detail'"/>
  </sql>
  <!-- 主键 -->
  <sql id="pkId">
    <bind name="pkName" value="'system_users_detail_id'"/>
  </sql>
  <!-- 批量删除-->
  <update id="delete" parameterType="String">
    <include refid="tableNameOut"></include>
    <include refid="pkId"></include>
    <include refid="PmBasicMapper.deleteSql"></include>
  </update>

  <!--动态sql分页列表-->

  <select id="list" resultMap="BaseResultMap" parameterType="com.domain.model.PageData">
    SELECT
    a.*,
    b.name,
    b.state,
    (select SUM(tatal_amount) from bill bl where bl.user_id = a.user_id and b.is_deleted=0) as'line_limit'
    FROM
    system_users_detail a
    inner JOIN system_users b  on a.user_id= b.user_id and b.is_deleted=0
    WHERE 1 = 1 and a.is_deleted =0
    <include refid="PmBasicMapper.retrieveSql"></include>
    ORDER BY  last_updated_date_time desc
  </select>

  <!--根据ID查找-->
  <select id="findByPkId" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from <include refid="tableName"></include>
    where system_users_detail_id = #{id,jdbcType=VARCHAR} AND is_deleted = 0
  </select>



  <!--根据userID查找-->
  <select id="findbyuserid" parameterType="com.domain.model.PageData" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List" />
    from <include refid="tableName"></include>
    where user_id = #{userId,jdbcType=VARCHAR} AND is_deleted = 0
  </select>

 <!--更改余额-->
  <update id="updateAmount" parameterType="com.domain.model.PageData">
    update system_users_detail
    set
    amount = #{amount,jdbcType=DECIMAL},

    last_updated_user_id = #{lastUpdatedUserId,jdbcType=CHAR},
    last_updated_user_name = #{lastUpdatedUserName,jdbcType=VARCHAR},
    last_updated_date_time = #{lastUpdatedDateTime,jdbcType=TIMESTAMP}

    where system_users_detail_id = #{systemUsersDetailId,jdbcType=CHAR}
  </update>





</mapper>